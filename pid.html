<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>PID ì œì–´ê¸° ì‹œë®¬ë ˆì´í„°</title>
  <style>
    body { font-family: sans-serif; max-width: 800px; margin: 20px auto; }
    h1, h2 { text-align: center; }
    label { display: block; margin-top: 10px; }
    input[type=range] { width: 100%; }
    #graph { height: 300px; }
  </style>
</head>
<body>

<h1>ğŸ”§ PID ì œì–´ê¸° ì‹œë®¬ë ˆì´í„°</h1>

<section>
  <label>Kp: <span id="kpVal">2.0</span></label>
  <input type="range" id="Kp" min="0" max="10" step="0.1" value="2.0" />
  
  <label>Ki: <span id="kiVal">1.0</span></label>
  <input type="range" id="Ki" min="0" max="5" step="0.1" value="1.0" />
  
  <label>Kd: <span id="kdVal">0.5</span></label>
  <input type="range" id="Kd" min="0" max="5" step="0.1" value="0.5" />
</section>

<canvas id="graph"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const t = Array.from({length: 500}, (_, i) => i * 0.02);  // 0~10ì´ˆ
const dt = 0.02;

// 2ì°¨ ì‹œìŠ¤í…œ ëª¨ë¸: G(s) = 1 / (s^2 + 2Î¶Ï‰_ns + Ï‰_n^2)
const zeta = 0.6;
const wn = 2.0;

function simulatePID(Kp, Ki, Kd) {
  let y = 0, y_dot = 0;      // ì¶œë ¥ y, ì†ë„
  let integral = 0;
  let prev_error = 1 - y;
  const response = [];

  for (let i = 0; i < t.length; i++) {
    const time = t[i];
    const setpoint = 1;
    const error = setpoint - y;
    integral += error * dt;
    const derivative = (error - prev_error) / dt;
    const u = Kp * error + Ki * integral + Kd * derivative;
    prev_error = error;

    // ì‹œìŠ¤í…œ: y'' + 2Î¶Ï‰_n y' + Ï‰_nÂ² y = u
    const y_ddot = u - 2 * zeta * wn * y_dot - wn ** 2 * y;
    y_dot += y_ddot * dt;
    y += y_dot * dt;

    response.push(y);
  }

  return response;
}

const ctx = document.getElementById("graph").getContext("2d");
const chart = new Chart(ctx, {
  type: 'line',
  data: {
    labels: t,
    datasets: [{
      label: 'ì‹œìŠ¤í…œ ì‘ë‹µ (y)',
      data: [],
      borderColor: 'blue',
      fill: false
    }]
  },
  options: {
    scales: {
      x: { title: { display: true, text: 'ì‹œê°„ (s)' } },
      y: { title: { display: true, text: 'ì¶œë ¥ y(t)' }, min: -0.5, max: 2 }
    }
  }
});

function updateChart() {
  const Kp = parseFloat(document.getElementById("Kp").value);
  const Ki = parseFloat(document.getElementById("Ki").value);
  const Kd = parseFloat(document.getElementById("Kd").value);

  document.getElementById("kpVal").textContent = Kp;
  document.getElementById("kiVal").textContent = Ki;
  document.getElementById("kdVal").textContent = Kd;

  const y = simulatePID(Kp, Ki, Kd);
  chart.data.datasets[0].data = y;
  chart.update();
}

document.querySelectorAll("input").forEach(input =>
  input.addEventListener("input", updateChart)
);

updateChart(); // ì´ˆê¸° ê·¸ë˜í”„
</script>

</body>
</html>
